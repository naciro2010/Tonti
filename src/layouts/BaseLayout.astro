---
import '../styles/global.css';
import { ClientProviders } from '../components/ClientProviders';
import { LanguageToggle } from '../components/LanguageToggle';
import { translate, defaultLocale, translations } from '../lib/i18n';
const { title = 'Tonti â€” Cagnotte digitale', description = translate('app.description', defaultLocale), lang = defaultLocale } = Astro.props;
const dir = lang === 'ar' ? 'rtl' : 'ltr';
const dictionary = JSON.stringify(translations);
---
<!DOCTYPE html>
<html lang={lang} dir={dir} class="bg-background">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Kufi+Arabic:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <script defer data-domain="tonti.app" src="https://plausible.io/js/script.js"></script>
  </head>
  <body class="flex min-h-screen flex-col">
    <ClientProviders client:load>
      <header class="sticky top-0 z-40 border-b border-white/10 bg-background/80 backdrop-blur">
        <div class="mx-auto flex w-full max-w-6xl items-center justify-between px-4 py-4">
          <a class="text-lg font-semibold text-primary" href="/" data-i18n="app.name">Tonti</a>
          <nav class="hidden items-center space-x-6 text-sm font-medium text-white/70 md:flex">
            <a href="/comment-ca-marche" class="hover:text-white" data-i18n="nav.how">{translate('nav.how', lang)}</a>
            <a href="/faq" class="hover:text-white" data-i18n="nav.faq">{translate('nav.faq', lang)}</a>
            <a href="/aide" class="hover:text-white" data-i18n="nav.support">{translate('nav.support', lang)}</a>
            <a href="/cgu" class="hover:text-white" data-i18n="nav.legal">{translate('nav.legal', lang)}</a>
            <a href="/confidentialite" class="hover:text-white" data-i18n="nav.privacy">{translate('nav.privacy', lang)}</a>
          </nav>
          <div class="flex items-center space-x-2">
            <LanguageToggle client:load />
            <a
              href="/auth/login"
              class="rounded-full border border-white/20 px-4 py-2 text-xs font-semibold uppercase tracking-wide text-white/80 hover:border-primary hover:text-white"
            >
              <span data-i18n="cta.login">{translate('cta.login', lang)}</span>
            </a>
          </div>
        </div>
      </header>
      <main class="flex-1">
        <slot />
      </main>
      <footer class="border-t border-white/10 bg-secondary/80">
        <div class="mx-auto flex w-full max-w-6xl flex-col space-y-4 px-4 py-8 text-sm text-white/70 md:flex-row md:items-center md:justify-between md:space-y-0">
          <p data-i18n="footer.rights">{translate('footer.rights', lang)}</p>
          <div class="flex space-x-4">
            <a href="/cgu" data-i18n="nav.legal">{translate('nav.legal', lang)}</a>
            <a href="/confidentialite" data-i18n="nav.privacy">{translate('nav.privacy', lang)}</a>
          </div>
        </div>
      </footer>
    </ClientProviders>
    <script>
      const translations = JSON.parse('{dictionary.replace(/\\/g, '\\\\').replace(/'/g, "\\'")}');
      const storageKey = 'tonti-lang';
      const applyTexts = (locale) => {
        document.querySelectorAll('[data-i18n]').forEach((node) => {
          const key = node.getAttribute('data-i18n');
          const value = translations?.[key]?.[locale];
          if (value) {
            node.textContent = value;
          }
        });
      };
      const current = localStorage.getItem(storageKey) || '{lang}';
      applyTexts(current);
      window.addEventListener('tonti:lang-changed', (event) => {
        const locale = event.detail;
        applyTexts(locale);
      });
    </script>
  </body>
</html>
